(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{519:function(a,t,e){"use strict";e.r(t);var r=e(3),n=Object(r.a)({},(function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"支付分享"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#支付分享"}},[a._v("#")]),a._v(" 支付分享")]),a._v(" "),e("h2",{attrs:{id:"文档地址"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#文档地址"}},[a._v("#")]),a._v(" 文档地址")]),a._v(" "),e("h4",{attrs:{id:"jsapi支付"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#jsapi支付"}},[a._v("#")]),a._v(" JSAPI支付")]),a._v(" "),e("p",[e("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=7_1",target:"_blank",rel:"noopener noreferrer"}},[a._v("微信JSAPI支付文档"),e("OutboundLink")],1),a._v(" "),e("a",{attrs:{href:"https://myjsapi.alipay.com/jsapi/native/trade-pay.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("支付宝JSAPI支付文档"),e("OutboundLink")],1)]),a._v(" "),e("h4",{attrs:{id:"小程序支付"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#小程序支付"}},[a._v("#")]),a._v(" 小程序支付")]),a._v(" "),e("p",[e("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/wxa/wxa_api.php?chapter=7_3&index=1",target:"_blank",rel:"noopener noreferrer"}},[a._v("微信小程序支付文档"),e("OutboundLink")],1),a._v(" "),e("a",{attrs:{href:"https://opendocs.alipay.com/mini/introduce/pay",target:"_blank",rel:"noopener noreferrer"}},[a._v("支付宝小程序支付文档"),e("OutboundLink")],1)]),a._v(" "),e("h4",{attrs:{id:"h5支付"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#h5支付"}},[a._v("#")]),a._v(" H5支付")]),a._v(" "),e("p",[e("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/H5.php?chapter=15_1",target:"_blank",rel:"noopener noreferrer"}},[a._v("微信H5支付文档"),e("OutboundLink")],1),a._v(" "),e("a",{attrs:{href:"https://docs.open.alipay.com/203",target:"_blank",rel:"noopener noreferrer"}},[a._v("支付宝H5支付文档"),e("OutboundLink")],1)]),a._v(" "),e("h2",{attrs:{id:"业务场景"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#业务场景"}},[a._v("#")]),a._v(" 业务场景")]),a._v(" "),e("h4",{attrs:{id:"jsapi支付-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#jsapi支付-2"}},[a._v("#")]),a._v(" JSAPI支付")]),a._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",[a._v("微信/生活号内，可以调用微信/支付宝支付下单购买的流程。")])]),a._v(" "),e("h4",{attrs:{id:"小程序支付-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#小程序支付-2"}},[a._v("#")]),a._v(" 小程序支付")]),a._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",[a._v("小程序中使用支付功能。")])]),a._v(" "),e("h4",{attrs:{id:"h5支付-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#h5支付-2"}},[a._v("#")]),a._v(" H5支付")]),a._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",[a._v("移动端网页应用中集成支付宝支付功能。")])]),a._v(" "),e("h3",{attrs:{id:"微信jsapi支付代码实现"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#微信jsapi支付代码实现"}},[a._v("#")]),a._v(" 微信JSAPI支付代码实现")]),a._v(" "),e("h4",{attrs:{id:"前端"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#前端"}},[a._v("#")]),a._v(" 前端")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('<script type="text/javascript" src="https://res.wx.qq.com/open/js/jweixin-1.3.2.js"><\/script>\n')])])]),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('function onBridgeReady(params) {\n\n        params = JSON.parse(params);\n\n        WeixinJSBridge.invoke(\n            \'getBrandWCPayRequest\', {\n                "appId": params.appId,     //公众号名称，由商户传入\n                "timeStamp": params.timeStamp,         //时间戳，自1970年以来的秒数\n                "nonceStr": params.nonceStr, //随机串\n                "package": params.package,\n                "signType": params.signType,         //微信签名方式：\n                "paySign": params.paySign //微信签名\n            },\n            function (res) {\n               \n                if (res.err_msg === "get_brand_wcpay_request:ok") {\n \t\t\t\t\t//支付成功\n                    return false;\n                }\n                \n                if (res.err_msg === "get_brand_wcpay_request:cancel") {\n                    //支付过程中用户取消\n                    return false;\n                }\n           \n                if (res.err_msg === "get_brand_wcpay_request:fail") {\n               \t\t//支付失败\n                    return false;\n                }\n            });\n    }\n')])])]),e("h3",{attrs:{id:"支付宝jsapi支付代码实现"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#支付宝jsapi支付代码实现"}},[a._v("#")]),a._v(" 支付宝JSAPI支付代码实现")]),a._v(" "),e("h4",{attrs:{id:"前端-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#前端-2"}},[a._v("#")]),a._v(" 前端")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('<script src="https://gw.alipayobjects.com/as/g/h5-lib/alipayjsapi/3.1.1/alipayjsapi.min.js"><\/script>\n')])])]),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("const tradeNO = res.data;\nap.tradePay({\n    tradeNO\n}, function(res) {\n    clickFlag = false;\n    if (res.resultCode === '9000') {\n        // 支付成功\n    } else if (res.resultCode === '6001') {\n        // 用户取消\n    }\n});\n")])])]),e("h3",{attrs:{id:"微信h5支付代码实现"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#微信h5支付代码实现"}},[a._v("#")]),a._v(" 微信H5支付代码实现")]),a._v(" "),e("h4",{attrs:{id:"java"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#java"}},[a._v("#")]),a._v(" Java")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('/**\n     * 微信H5调起支付\n     *\n     * @param tradeNo     交易流水号(可用平台的订单号)\n     * @param tradeAmount 交易金额(元)\n     * @param body        商品描述\n     * @param ip          请求的ip\n     * @return java.util.Map<java.lang.String,java.lang.String>\n     * @throws Exception 异常\n     */\n    public Map<String, String> h5Pay(String tradeNo, BigDecimal tradeAmount, String body, String ip,\n                                     WeChatPayTypeEnum payType, String productType, String cardPwd, CardProductTypeEnum cardProductType) throws Exception {\n        //订单金额（分）\n        BigDecimal fee = new BigDecimal(100).multiply(tradeAmount);\n        //构造请求参数\n        Map<String, String> requestData = new HashMap<>(16);\n        requestData.put("nonce_str", generateUUID());\n        requestData.put("body", body);\n        requestData.put("out_trade_no", tradeNo);\n        requestData.put("total_fee", String.valueOf(fee.intValue()));\n        requestData.put("spbill_create_ip", ip);\n        requestData.put("notify_url", weChatExchangeConfig.getWeChatH5NotifyUrl());\n        requestData.put("trade_type", "MWEB");\n        requestData.put("scene_info", " {\\"h5_info\\" : {\\"type\\" : \\"Wap\\",\\"wap_name\\" : \\"大地保险\\",\\"wap_url\\" : \\"https://www.chengquan.cn/\\"}} ");\n        requestData.put("appid", weChatExchangeConfig.getAppId());\n        requestData.put("mch_id", weChatExchangeConfig.getMerchantId());\n        requestData.put("nonce_str", generateUUID());\n        requestData.put("sign_type", WeChatPayConstant.MD5);\n        requestData.put("sign", generateSignature(requestData, weChatExchangeConfig.getTradeKey(), WeChatPayConstant.SignType.MD5));        String responseData = requestOnce(weChatExchangeConfig.getPayUrl(), generateUUID(), mapToXml(requestData),\n                CommonWhetherEnum.YES, 30000, 30000, false);\n        log.info("交易流水号[{}]发起微信支付请求, 请求:[{}] 响应:[{}]", tradeNo, requestData, responseData);\n        Map<String, String> resultMap = xmlToMap(responseData);\n        //组装前端唤起支付控件参数\n        Map<String, String> weChatJSBridge = new HashMap<>(16);\n        String singleProduct = "SINGLE";\n        if (singleProduct.equals(productType)) {\n            weChatJSBridge.put("mweb_url", StringUtils.trimToEmpty(resultMap.get("mweb_url")) + "&redirect_url=" + URLEncoder.encode(weChatExchangeConfig.getContinentalInsuranceH5BaseUrl() + "/payCoupon?tradeNo=" + tradeNo + "&cardPwd=" + cardPwd + "&productType=" + cardProductType, "UTF-8"));\n        } else {\n            weChatJSBridge.put("mweb_url", StringUtils.trimToEmpty(resultMap.get("mweb_url")) + "&redirect_url=" + URLEncoder.encode(weChatExchangeConfig.getContinentalInsuranceH5BaseUrl() + "/exchangeProducts?tradeNo=" + tradeNo + "&cardPwd=" + cardPwd + "&productType=" + cardProductType, "UTF-8"));\n        }\n        weChatJSBridge.put("tradeNo", tradeNo);\n        weChatJSBridge.put("errorCode", "200");\n        return weChatJSBridge;\n    }\n')])])]),e("h4",{attrs:{id:"响应"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#响应"}},[a._v("#")]),a._v(" 响应")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('15:40:11.474 INFO  vip.chengquan.utils.WeChatPayUtil - 交易流水号[WE1578987610938133195]发起微信支付请求, 请求:[{nonce_str=f28ee8ee2183403fb2da945591d9f46f, out_trade_no=WE1578987610938133195, total_fee=1000, appid=wx27b89fe84f11c153, sign=8370E8154C6ED0901039F290E338DE46, trade_type=MWEB, body=全国话费通兑20元, notify_url=http://wx5.ejiaofei.com/customized/wechat/weChatH5PayNotify, mch_id=1563058751, spbill_create_ip=120.192.78.162, sign_type=MD5, scene_info= {"h5_info" : {"type" : "Wap","wap_name" : "大地保险","wap_url" : "https://www.chengquan.cn/"}} }] 响应:[<xml><return_code><![CDATA[SUCCESS]]></return_code>\n<return_msg><![CDATA[OK]]></return_msg>\n<appid><![CDATA[wx27b89fe84f11c153]]></appid>\n<mch_id><![CDATA[1563058751]]></mch_id>\n<nonce_str><![CDATA[cujDUjojCA8N0AdL]]></nonce_str>\n<sign><![CDATA[2582A90A6A9B3281F03F3E4640BF735C]]></sign>\n<result_code><![CDATA[SUCCESS]]></result_code>\n<prepay_id><![CDATA[wx1415401089785403f377abc41952169600]]></prepay_id>\n<trade_type><![CDATA[MWEB]]></trade_type>\n<mweb_url><![CDATA[https://wx.tenpay.com/cgi-bin/mmpayweb-bin/checkmweb?prepay_id=wx1415401089785403f377abc41952169600&package=3325615748]]></mweb_url>\n</xml>]\n')])])]),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('{\n    "tradeNo": "WE1578987687847491154", \n    "mweb_url": "https://wx.tenpay.com/cgi-bin/mmpayweb-bin/checkmweb?prepay_id=wx141541275914026b117142631327669400&package=2192925583&redirect_url=http%3A%2F%2Fwx5.ejiaofei.com%2Fcustomized%2FcontinentalInsurance%2F%2FexchangeProducts%3FtradeNo%3DWE1578987687847491154%26cardPwd%3DyKuVPTBr4l%2FhGV20PH4Ut5fHMFiYC6LZ%26productType%3DRECHARGE", \n    "errorCode": "200"\n}\n')])])]),e("h4",{attrs:{id:"前端-3"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#前端-3"}},[a._v("#")]),a._v(" 前端")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("  window.location.href = res.mweb_url;\n")])])]),e("h3",{attrs:{id:"支付宝h5支付"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#支付宝h5支付"}},[a._v("#")]),a._v(" 支付宝H5支付")]),a._v(" "),e("h4",{attrs:{id:"java-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#java-2"}},[a._v("#")]),a._v(" Java")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v(' /**\n     * 支付宝h5支付\n     *\n     * @param tradeNo     交易号\n     * @param tradeAmount 交易金额\n     * @param subject     标题\n     * @param notifyUrl   支付成功通知地址\n     * @param redirectUrl 支付成功跳转地址\n     * @return Map\n     * @throws Exception 异常\n     */\n    public Map<String, String> wapPay(String tradeNo, BigDecimal tradeAmount, String subject,\n                                      String notifyUrl, String redirectUrl) throws Exception {\n        AlipayClient alipayClient = new DefaultAlipayClient(alipayConfig.getGatewayUrl(),\n                alipayConfig.getAppId(), alipayConfig.getPrivateKey(), "json", "utf-8",\n                alipayConfig.getPublicKey(), "RSA2");\n        AlipayTradeWapPayRequest wapPayRequest = new AlipayTradeWapPayRequest();\n        JSONObject aliJsBridge = new JSONObject();\n        aliJsBridge.put("subject", subject);\n        aliJsBridge.put("out_trade_no", tradeNo);\n        aliJsBridge.put("product_code", "QUICK_WAP_WAY");\n        aliJsBridge.put("body", "橙券权益卡商城");\n        aliJsBridge.put("total_amount", tradeAmount);\n        aliJsBridge.put("timeout_express", "10m");\n        wapPayRequest.setNotifyUrl(notifyUrl);\n        wapPayRequest.setReturnUrl(redirectUrl);\n        wapPayRequest.setBizContent(aliJsBridge.toString());\n        AlipayTradeWapPayResponse alipayTradeWapPayResponse = alipayClient.pageExecute(wapPayRequest);\n        if (alipayTradeWapPayResponse.isSuccess()) {\n            // 组装返回前端数据\n            Map<String, String> aliPayMsg = new HashMap<>(6);\n            aliPayMsg.put("payUrl", alipayTradeWapPayResponse.getBody());\n            aliPayMsg.put("tradeNo", tradeNo);\n            aliPayMsg.put("errorCode", "200");\n            return aliPayMsg;\n        } else {\n            throw new ErrorCodeException(ErrorCodeEnum.NO, "调用支付宝支付失败");\n        }\n    }\n')])])]),e("h4",{attrs:{id:"响应-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#响应-2"}},[a._v("#")]),a._v(" 响应")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('{errorCode=200, data={errorCode=200, payUrl=<form name="punchout_form" method="post" action="https://openapi.alipay.com/gateway.do?charset=utf-8&method=alipay.trade.wap.pay&sign=hT9lghjBNJgdj5R3sOC1hDhK0DTAmwuu1hk2Z3Z1hBsxo1dxMQ%2Fnh%2BsQ3BWL5sz9JW1cuhDhfylp2u1T8ORW72tlc0HmABiYQIuot7RICAclJ0yINrASG8hNI3Y8VqTlXGzuK%2Bnb8CRNzCJ6XG30Zbi4cjBbfN7tLj%2BAVVfiMrzwB4HMhgnsckQG9d5om9G0OmeNweQxcChiO1150zyRxPNn4TgC%2BELQgbyS48%2FhRn5t7asc93TdbIlEH9gyQrQgNYekWs9pGBgxudtX6rMO8HNLUEUhkGGTHs1%2FwqGHjB4ZyzZVLY9HrBxBppYsFs1zTZwWcEKtGTMeNOa8Q0BcfA%3D%3D&return_url=http%3A%2F%2Fwx.ejiaofei.com%2Fequitycard%2FequityCard%2FproductDetail%3Fid%3D3587&notify_url=http%3A%2F%2Fwx.ejiaofei.com%2Fequitycard%2FstoreOrder%2FaliPayNotify&version=1.0&app_id=2019072365931371&sign_type=RSA2&timestamp=2020-01-15+09%3A21%3A34&alipay_sdk=alipay-sdk-java-3.7.110.ALL&format=json">\n<input type="hidden" name="biz_content" value="{&quot;out_trade_no&quot;:&quot;QY1579051294548181674&quot;,&quot;total_amount&quot;:0.01,&quot;subject&quot;:&quot;周卡&quot;,&quot;timeout_express&quot;:&quot;10m&quot;,&quot;product_code&quot;:&quot;QUICK_WAP_WAY&quot;,&quot;body&quot;:&quot;橙券权益卡商城&quot;}">\n<input type="submit" value="立即支付" style="display:none" >\n</form>\n<script>document.forms[0].submit();<\/script>, tradeNo=QY1579051294548181674}, errorMsg=null}\n\n')])])]),e("h4",{attrs:{id:"前端-4"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#前端-4"}},[a._v("#")]),a._v(" 前端")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('<div id="aliPay" class="hide"></div>Ï\n')])])]),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v(" $('#aliPay').html(res.data.payUrl);\n")])])]),e("h2",{attrs:{id:"问题分享"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#问题分享"}},[a._v("#")]),a._v(" 问题分享")]),a._v(" "),e("h3",{attrs:{id:"微信h5支付回调地址"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#微信h5支付回调地址"}},[a._v("#")]),a._v(" 微信H5支付回调地址")]),a._v(" "),e("p",[a._v("正常流程用户支付完成后会返回至发起支付的页面，如需返回至指定页面，则可以在MWEB_URL后拼接上redirect_url参数，来指定回调页面。")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("假设您通过统一下单接口获到的MWEB_URL= https://wx.tenpay.com/cgi-bin/mmpayweb-bin/checkmweb?prepay_id=wx20161110163838f231619da20804912345&package=1037687096\n\n\n则拼接后的地址为MWEB_URL= https://wx.tenpay.com/cgi-bin/mmpayweb-bin/checkmweb?prepay_id=wx20161110163838f231619da20804912345&package=1037687096&redirect_url=https%3A%2F%2Fwww.wechatpay.com.cn\n")])])]),e("p",[a._v("注意：\n1.需对redirect_url进行urlencode处理")]),a._v(" "),e("p",[a._v("2.由于设置redirect_url后,回跳指定页面的操作可能发生在：1,微信支付中间页调起微信收银台后超过5秒 2,用户点击“取消支付“或支付完成后点“完成”按钮。因此无法保证页面回跳时，支付流程已结束，所以商户设置的redirect_url地址不能自动执行查单操作，应让用户去点击按钮触发查单操作。")]),a._v(" "),e("h3",{attrs:{id:"微信h5支付其他常见问题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#微信h5支付其他常见问题"}},[a._v("#")]),a._v(" 微信H5支付其他常见问题")]),a._v(" "),e("ol",[e("li",[a._v("商家参数格式有误，请联系商家解决\n"),e("ol",[e("li",[a._v("当前调起H5支付的referer为空导致，一般是因为直接访问页面调起H5支付，请按正常流程进行页面跳转后发起支付，或自行抓包确认referer值是否为空")]),a._v(" "),e("li",[a._v('如果是APP里调起H5支付，需要在webview中手动设置referer，如(\nMap extraHeaders = new HashMap();\nextraHeaders.put("Referer", "商户申请H5时提交的授权域名");//例如 http://www.baidu.com ))')])])]),a._v(" "),e("li",[a._v("商家存在未配置的参数，请联系商家解决")]),a._v(" "),e("li",[a._v("请在微信外打开订单，进行支付")]),a._v(" "),e("li",[a._v("IOS：签名验证失败 安卓：系统繁忙，请稍后再试")])]),a._v(" "),e("h3",{attrs:{id:"h5嵌入app（ios）"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#h5嵌入app（ios）"}},[a._v("#")]),a._v(" H5嵌入APP（iOS）")]),a._v(" "),e("p",[a._v("嵌入APP APP不做处理默认跳转到浏览器\n如需跳转回APP，需APP端进行处理")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("https://wx.tenpay.com/cgi-bin/mmpayweb-bin/checkmweb?prepay_id=wx20161110163838f231619da20804912345&package=1037687096&redirect_url=https%3A%2F%2Fwww.wechatpay.com.cn\n")])])]),e("p",[e("strong",[a._v("URL Scheme")])]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("https://wx.tenpay.com/cgi-bin/mmpayweb-bin/checkmweb?prepay_id=wx20161110163838f231619da20804912345&package=1037687096&redirect_url=test://\n")])])]),e("p",[e("strong",[a._v("universeallink")])]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("https://wx.tenpay.com/cgi-bin/mmpayweb-bin/checkmweb?prepay_id=wx20161110163838f231619da20804912345&package=1037687096&redirect_url=https://custapp-uat.ccic-net.com.cn/\n")])])]),e("p",[a._v("使用 universeallink 需将 地址配置到H5支付域名中。")])])}),[],!1,null,null,null);t.default=n.exports}}]);